# 一、Zookeeper介绍
## 1、什么是Zookeeper
在分布式组件里面，Zookeeper是一个为其他分布式服务提供协调服务的中间件。

服务包含：统一配置管理、统一命名服务、分布式锁、集群管理、分布式队列、数据发布订阅等。

本质上可以归纳为两类：
* 基于ZNode树的数据管理
* 数据的通知和监听

## 2、Zookeeper的应用场景
Zookeeper启动时，它会创建一个分层的命名空间，称为ZNode树。
ZNode是Zookeeper中的基本数据节点，类似于文件系统中的文件夹。

接下来，当应用程序连接到Zookeeper时，它可以使用Zookeeper提供的API将自己的信息存储在ZNode上。这个过程被称为注册。

### 统一配置管理
在**配置管理服务**中，应用程序可以使用Zookeeper提供的API轻松读取和更改配置。
Zookeeper允许多个应用程序同时监听某个ZNode，从而使它们能够及时获得配置更改通知。

### 统一命名服务
在命名服务中，应用程序可以使用Zookeeper提供的API在特定的ZNode路径下注册或查找它们的服务名称。
Zookeeper会将这些服务名称分配给一个全局唯一的标识符，并允许其他应用程序查找它们。

### 分布式锁
在分布式锁管理中，应用程序可以使用Zookeeper提供的API创建锁节点。
只有一个应用程序能够成功地在该节点上创建子节点，从而获得锁。
其他应用程序必须等待当前持有锁的应用程序释放锁，然后才有机会获取锁并执行相应的任务。

### 集群管理
集群状态管理：所有服务节点创建临时节点，然后监听子节点的变化消息。比如一旦有机器挂掉，临时节点删除，其他节点收到通知。

集群负载均衡：所有服务节点创建临时节点，zookeeper根据负载均衡算法将任务分发到各个机器节点中处理。

集群leader选举：多个客户端请求创建同一个临时节点，最终只有一个客户端请求能够创建成功。

### 分布式队列
在分布式队列中，应用程序可以使用Zookeeper提供的API将任务添加到队列中，然后由不同的工作进程处理这些任务。
当一个任务被添加到队列中时，它将作为一个ZNode被创建。多个工作进程可以同时监听该ZNode，以便及时获取新任务的通知。

### 数据发布订阅
Zookeeper 提供了一种称为“Watcher 机制”的发布/订阅模式，用于实现数据的发布和订阅。
具体来说，Zookeeper 允许客户端在某个节点上设置 Watcher，
当该节点的状态发生变化时，Zookeeper 会通知所有订阅该节点的客户端，从而实现数据的发布/订阅。

下面是 Zookeeper 实现**数据发布/订阅的步骤**：

1）客户端向 Zookeeper 服务器注册一个 Watcher，指定要监控的节点路径。

2）当该节点的状态发生变化（例如节点数据被修改、节点删除等），Zookeeper 会将变化通知所有注册了 Watcher 的客户端。

3）客户端接收到 Watcher 通知后，可以采取相应的操作，例如重新获取节点数据、更新本地缓存等。

4）如果客户端不再需要订阅节点的变化，可以取消 Watcher 注册。

总体来说，Zookeeper通过提供基于ZNode树的数据存储和一组强大的API，使得这些服务变得非常容易实现。
应用程序只需要使用这些API来注册、读取和创建ZNode，就可以使用Zookeeper提供的各种服务。

## 3、Zookeeper的特性
- 全局数据一致：集群中每个服务器保存一份相同的数据副本，client无论连接到哪个服务器，展示的数据都是一致的，这是最重要的特征；

- 可靠性：如果消息被其中一台服务器接受，那么将被所有的服务器接受。

- 顺序性：包括全局有序和偏序两种：
  - 全局有序是指如果在一台服务器上消息a在消息b前发布，则在所有Server上消息a都将在消息b前被发布；
  - 偏序是指如果一个消息b在消息a后被同一个发送者发布，a必将排在b前面。

- 数据更新原子性：一次数据更新要么成功（半数以上节点成功），要么失败，不存在中间状态；

- 实时性：Zookeeper保证客户端将在一个时间间隔范围内获得服务器的更新信息，或者服务器失效的信息。

