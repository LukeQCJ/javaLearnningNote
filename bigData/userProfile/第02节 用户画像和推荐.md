# 一、用户画像概述
【用户画像】用来勾画用户（用户背景、特征、性格标签、行为场景等）和联系用户需求与产品设计的，
旨在通过从海量用户行为数据中炼银挖金，尽可能全面细致的抽出一个【用户的信息全貌】，从而帮助解决如何把数据转为商业价值的问题。

## 1.1、用户画像数据来源

用户画像计算引擎的数据流：
```text
【用户行为日志】 ==> 【画像计算结果】 ==> 【用户属性】和【画像更新】 ==> 【用户画像】
```

以电影网站的用户画像分析为例。

用户画像数据来源中连个最终要的数据就是用户属性以及物品属性，
有了这两个，我们就可以从用户-用户、用户-电影、电影-电影三方面展开相应的相似度计算从而实施相应的推荐与应用。

### 1.1.1 用户属性
【用户属性】用来描述一个用户的个性，从而用于与其他用户加以区分，
为实现精准及个性化的推荐，系统通常对每个用户都有一个用户属性的建模，
其中包括用户的基本信息，如用户的性别、年龄、年收入、兴趣爱好、活跃时间、所在城市等。

如果计算得到用户A和用户B的属性相似度较高，那么系统就会认为用户A和用户B是相似用户，
在推荐引擎中，基于邻居用户群的观影喜好推荐给当前用于一些电影。

同时，用户属性还可以用于推荐结果进行过滤和排序，从而优化推荐结果。

### 1.1.2 物品属性
【物品属性】是用来描述一个物品的特点，比如观影，这个影片就会有相应的属性标签，比如动作片、爱情片、导演、主演、上映地区等。
通过对影片属性进行相应的标签化，为后面的推荐提供数据支撑。

# 二、用户画像建模
用户画像建模就是用户信息的标签化，以便为后面的推荐算法提供更精准的语义信息。它的核心是对用户潜在的意图和兴趣进行表示和存储，根据用户的基础信息、视频信息、访问信息、行为偏好等归纳出可读取，可计算的用户模型。用户画像通常包含定性画像和定量画像两个部分，其中定性画像主要包括用户的基本特征、行为刻画、兴趣模型和视频表征等，定量画像主要包括用户基础变量、兴趣偏好等可量化的数据特征。所谓的定量画像就是通过某种可量化的数据特征进行画像，比如某个东西的购买量，点击量等。

## 2.1 用户定量画像
定量画像建模过程中需要重点考虑的是用户画像的颗粒度，
即用户画像应该细化到何种程度，颗粒度越小，用户画像越细，也就更加有利于提高推荐系统的准确性。

然而，也不是越细越好，一方面提高了用户画像建模成本，同时也会导致用户画像的使用性降低，
如何把握好用户画像的颗粒度可以采取问卷调查的方法了解用户的使用场景、关注内容等。
可以通过表单收集捕捉用户行为。

## 2.2 用户定性画像
标签化是用户定性画像的核心。
标签化之后，
首先，计算机可以自动完成【分类统计】功能，
例如，可以统计喜欢科幻类型电影的用户有多少，还可以进一步统计喜欢观看科幻类型电影的人群中男女比例是多少，
其次，计算机也可以根据这些标签进行【深度挖掘】，
例如，可以利用关联规则计算用户年龄和喜欢电影类型的关系，还可以利用聚类算法分析喜欢科类型电影用户的年龄段分布情况。
将标签信息与用户的视频浏览、点播行为数据相结合就可以进一步预测用户的喜好，这对于搜索引擎、广告投放等应用领域都有显著的意义。

一个产品通常会设计4~6个标签代表所有的用户群体。

互联网常用用户标识方法：

| 用户标识方式   | 特点                        | 局限性                      |
|----------|---------------------------|--------------------------|
| Cookie   | 能够标识匿名、未注册用户              | 通常有一定有效期，不易跨浏览器、设备       |
| 注册ID     | 网站的用户标识                   | 用户注册意愿低，需要投入大量推广运营成本     |
| Email    | 互联网早期常用的用户标识方式            | 一个用户可能有多个Email，此标识会损失准确性 |
| 微信、微博、QQ | 互联网共识的第三方登录ID，提供OAuth授权机制 | 标识具有准确性和持久性              |
| 手机号      | 移动端最精确的标识                 | 较难获取到，视产品激励用户意愿          |
| 身份证      | 最官方的标识                    | 难获取到，视产品激励用户意愿           |

**用户定性画像结构：**
- 用户维度
  - 用户特征：姓名、年龄、职业等
  - 用户行为：视频点播、视频浏览等
  - 用户兴趣偏好：观看时间偏好、观看视频类别偏好等
- 视频维度
  - 视频特征：类别、导演、主题等

## 2.3 基于知识的用户定性画像分析
基于知识的用户定性画像分析其【核心思想】是利用本体对用户画像中的标签进行表示、验证、推理和解释等，
具体来说包括用户和视频的标签以及它们之间的关系进行形式化的表述，从语义层面描述视频、用户及其兴趣特征，
主要以观众和视频的相关知识作为画像建模的核心。

本体侧重对特定工程领域中的知识进行建模，提供专业领域中概念的词汇表以及概念间的关系，
是在语义层次上对信息进行的形式化描述。主流的本体开发工具是Protege。
本体描述语言OWL DL。

# 三、群体用户画像分析
【群体用户画像分析】是指【用户间的关联分析】。

群体用户画像分析的流程主要包括：
- 1）、用户画像的获取
- 2）、用户画像相似度计算，根据不同的用户画像计算相互间的相似度，是区分用户群体的重要指标，也是展开用户画像聚类的前提条件。
- 3）、用户画像聚类，根据用户画像间的相似度，将相似的用户画像聚为一类。
- 4）、群体用户画像生成，针对不同类别的用户分别建立有代表性的典型用户画像。

通过群体用户画像分析可以获取需求相近的用户群。

## 3.1 定量相似度计算
定量标签有确定的数值，如用户画像中年龄等数据，其相似度计算相对简单。

对与群体用户画像聚类分析中一组定量标签来说，相似度计算为：
```text
sim(Ui, Uj) = SUM{1, k}(W{k} * sim(profile{k}(Ui), profile{k}(Uj)))
```
其中，W{k}表示第k个定量标签的权重，
profile{k}(Ui)标识用户i在第k个定量标签下的值，
sim(profile{k}(Ui), profile{k}(Uj))表示用户画像Ui和用户画像Uj在第k个定量标签的相似度。
SUM{1, k}是从第1个到第k个标签的权重w与相似度求和。

在计算用户画像相似度的过程中，往往会基于多个定量标签的数据来计算相似度。
值得注意的是，不同定量标签数值的取值范围可能存在数量级别的差异，
从而使得相似度计算过程中，某些定量标签对综合相似度贡献微乎其微。
因此，在计算之前，对不同定量标签的数据进行归一化处理就尤为重要。

### 3.1.1 归一化方式
归一化是物理系统中一种无量纲处理手段。在这里，归一化是将不同取值范围的定量标签数据统一映射到【0，1】区间。
常用的归一化方法有线性函数转换、对数函数转换、反正切函数转换等。

线性函数转换（最小-最大值转换）：
```text
Y = abs((X - X最小值) / (X最大值 - X最小值))
```
其中，X、Y分别标识转换前、后的值。

对数函数转换为：
```text
Y = log10(X)
```

反正切函数转换为：
```text
Y = atan(X)^2 / pi
```

### 3.1.2 计算相似度方法
具体的某个定量标签相似度数值计算应根据具体的用户画像采用不同的计算方式，可以采用欧式距离、余弦相似度、Jaccard系数等。
对于标量标签，通常采用欧氏距离、曼哈顿距离和余弦相似度。

欧式距离，欧几里得距离，是一个通常采用的距离定义，是多维空间中两点的真实距离，其计算公式为：
```text
sim(Ui, Uj) = sqrt(SUM{1, k}((profile{k}(Ui) - profile{k}(Uj))^2))
```

曼哈顿距离，城市街区距离，是两个点在标准坐标系上的绝对轴距的总和，其计算公式为：
```text
sim(Ui, Uj) = SUM{1, k}(abs(profile{k}(Ui) - profile{k}(Uj))))
```

余弦相似度将用户评分看作一个向量，用向量的余弦夹角度量用户间的相似性，其计算公式为：
```text
sim(Ui, Uj) = SUM{1, k}(
    (profile{k}(Ui) / sqrt(SUM{1, k}(profile{k}(Ui)^2))) 
        * 
    (profile{k}(Uj) / sqrt(SUM{1, k}(profile{k}(Uj)^2)))
)
```
然而上述余弦相似性度量方法没有包含用户画像各个标签数值的统计特征。
修正的余弦相似度通过减去群体用户画像各个标签数值的平均值来改善上述缺陷。
```text
sim(Ui, Uj) = SUM{1, k}(
((profile{k}(Ui) - mean_profile(Ui)) / sqrt(SUM{1, k}((profile{k}(Ui) - mean_profile(Ui))^2)))
 * 
((profile{k}(Uj) - mean_profile(Uj)) / sqrt(SUM{1, k}((profile{k}(Uj) - mean_profile(Uj))^2)))
)
```

对于二元变量，即取值只为0和1两种，如果采用以上方法则不能很好地标识其相似度，
因此一种常用的方法是计算Jaccard系数，Jaccard系数计算公式为：
```text
sim(Ui, Uj) = abs(profile(Ui)与profile(Uj)交集 / profile(Ui)与profile(Uj)并集)
```

## 3.2 定性相似度计算
定性标签通过概念表示。由于定性标签没有确定的数值，其相似度计算不能采取像定量标签那样直接的计算方法。

定性相似度的计算可以从两个方向展开，
一个方向是将定性标签映射为定量标签，进而采用定量标签的相似度计算方法；
另一个方向是直接采用基于概念的相似度计算方法。

# 四、用户画像更新触发条件
用户画像的更新触发条件通常采用以下三种方式：
- 第一种方式：通过设置一个阈值，当获取的实时画像数据量超过这一阈值时，根据存储的画像数据构建用户画像；
- 第二种方式：设置一个时间周期，每隔该周期时间根据存储的画像数据构建用户画像；
- 第三种方式：首先从增加的数据中挖掘用户画像，然后将其与原先得到的用户画像进行比较，根据比较的结果来决定是否更新。

不同的方式有不同的适应场景，第一种方式适合数据敏感型的用户画像，第二种方式适合时效性要求较高的适应场景，第三种凡是适合相对稳定的用户画像。

更新机制：
用户数据总是处在不断更新的状态，当用户画像数据库发生变化后，如何对已经得到的用户画像进行更新维护是需要解决的重要问题。

一个直接的办法是完全更新，即读取所有历史用户数据重新生成用户画像。
其显而易见的缺点就是计算量大、耗费时间长。

而增量更新是指在进行更新操作时，只更新需要改变的地方，不需要更新或者已经更新过的地方则不会重复更新。
相对于完全更新，增量更新的优势是计算量较少，因此，赠礼更新被广泛应用。
比较常见的增量式更新算法是滑动窗口过滤算法，该算法强调滑动时间窗口的概念，
当数据库更新时，只需要移动时间窗口，删除旧有的候选集，再加上新增的候选项目集即可。

增量更新实现的前提条件是对历史用户数据进行计算并存储中间值，基于该存储的中间值和新增数据计算得到新的用户画像。
其中，存储的中间值应该涉及不同的粒度。因此，中间值具有较大的冗余，且需要较长时间的存储中间结果，耗费空间。
但正是由于这种冗余，使得增量更新时能够在不同粒度进行灵活计算。
例如，在一个推荐系统中，在不同时间粒度内，基于用户的观影行为日志，以演员为单位采用计数方式进行更新计算视频的观看次数。
采用不同粒度时间范围，可以灵活地响应用户的查询需求，方便进行快速计算。

# 五、推荐概述
常见的推荐算法，根据使用数据源的不同，可将其大致分为三类：分别是协同过滤的推荐方法、基于内容的推荐方法、基于知识的推荐方法，
以及这三类算法进行不同程度融合之后出现的混合推荐算法。

## 5.1 主流推荐方法的分类
### 5.1.1 协同过滤的推荐方法
考虑这样一个问题，当你想看调用却不知道看什么调用时你会怎么做？

大部分人会询问身边的朋友有什么值得推荐的电影，在选择时往往更倾向于与自己观看爱好相似的朋友所推荐的。
“跟你爱好相似的用户喜欢的东西你可能也会喜欢”，这就是协同过滤的基本思想，利用群体智慧以“协作”的方式进行推荐。
这种协作可以是基于用户之间的协作，首先系统要圈定与目标用户有相似偏好的用户群，然后将他们评价较高的视频推荐给该用户；
也可以是基于视频之间的协作，首先系统要建立并维护一个视频之间的相似度矩阵，然后圈定那些与该用户评过高分的视频相似的视频，再将这些视频推荐给他。

基于用户和基于视频的推荐算法都属于协同过滤推荐方法中的第一类，即基于记忆的推荐方法。
第二类算法是基于模型的推荐算法，是使用了机器学习中的模型与算法来辅助推荐的方法。

协同过滤的推荐方法，共享朋友的经验，有效地使用其他用户的反馈信息，能够提高推荐的准确度。
在基于用户的推荐中，根据爱好相似的用户喜欢的视频为用户进行推荐，可以发现用户潜在的兴趣，增加推荐的多样性。

协同过滤的推荐方法存在以下的局限性：
- 1）由于新用户没有朋友、观看的视频等有用信息，新视频没有被用户观看的信息，因此系统无法对新视频、新用户做出推荐，这被称为用户和物品的冷启动问题。
- 2）因为不对视频内容做分析，所以无法依据深层特征和属性来推荐比较复杂的视频，使得用户对推荐结果的可信度产生质疑。
- 3）受到用户打分稀疏性问题的约束。
- 4）随着用户和视频数量的增大、系统计算量的增大，受到算法可扩展性问题的约束。

### 5.1.2 基于内容的推荐方法
基于【内容（Content-based，CB）】的推荐方法起源于信息检索和信息过滤领域，它根据用户的历史信息，为用户推荐与他过去喜欢的视频相似的其他视频。
例如，一个用户喜欢观看“贞子”、“咒怨”、“鬼伎回忆录”等日本恐怖片，那么基于内容的推荐引擎就会根据“日本”、“恐怖片”等一些列关键词为用户推荐相似的影片，如“午夜凶铃”。
如果用户喜欢“速度与激情”，系统就会推荐“速度与激情2”等这一系列的其他电影或者类似的赛车题材、热血的欧美电影。

基于内容的推荐方法体现了一种很直接的推荐思路，它是从视频内容是否与用户偏好匹配的角度来向用户做出推荐的。
这就需要推荐系统首先通过分析用户的历史行为数据来建立【用户画像（User Profile）】，以之代表用户的行为偏好；
同时需要分析提取所有视频的内容特征来建立视频的【物品画像（Item Profile）】，以之代表视频的特征属性。
在得到了用户画像和物品画像的前提下，通过相似度比较来做出推荐。

基于信息检索的启发式算法和基于机器学习的自适应算法是基于内容的两大类推荐算法。
前者是将信息检索领域中的TF-IDF算法应用到推荐中，后者是使用了机器学习中的模型与算法来建立用户画像。
目前，一般视频网站采用结合视频内容和用户标签的方法进行内容过滤。

基于内容的推荐方法根据目标用户画像和物品画像的匹配程度进行推荐，不需要其他用户的数据，所以不存在视频的冷启动问题，
并能为拥有特殊兴趣爱好的用户做推荐。
基于内容的推荐在推荐视频时能够列出推荐视频的特征作为推荐理由，更容易为用户所接受。

基于内容的推荐算法存在以下的局限性：
- 1）容易受到信息获取技术的约束，难以提取视频的内容特征，而使用标签对视频进行标注的方法工作量巨大而效用低。
- 2）需要有足够的数据用来构建决策分类器，用户画像的建立需要大量的用户浏览记录。
- 3）难以为用户发现新的兴趣信息，只能推荐与用户已有兴趣相似的视频。

基于内容的推荐方法和协同过滤方法中基于视频之间的协作的最大区别是，它不需要任何用户数据，
而基于视频之间的协作它需要维护一个视频之间相似度矩阵，然后将和该用户评过高分相似的视频推荐给该用户，它的主要数据对象是用户和视频，
而基于内容的推荐方法的数据对象就只是某一个用户的历史视频。

### 5.1.3 基于知识的推荐方法
协同过滤和基于内容的推荐方法实际上是在分析系统已知数据的基础上去推测用户的选择行为，是一个比较有把握的“猜”的过程。

而基于知识（Knowledge-based，KB）的推荐方法首先是“问”的过程，通过交互、会话等方式直接了解到用户需求，然后进行视频匹配，即“找”的过程。
基于知识的推荐方法可应用于前两类推荐方法所不擅长得推荐场景，但前提是需要对“知识”进行形式化的定义和表示。

这类推荐方法包括基于约束（Constraint-based）的推荐算法和基于实例（Case-based）的推荐算法，
前者侧重于使用用户需求的形式化条件进行搜索，后者侧重于在已有实例的基础上进行匹配和调试。

基于知识的视频推荐引擎通过与用户的交互获取信息做推荐，能够很好地给出视频的推荐理由；系统不依赖于用户偏好信息，因此不存在用户的冷启动问题；
基于知识的推荐系统能够与用户交互从而及时响应用户需求，用户偏好发生改变时不需要任何训练。

基于知识的推荐算法存在以下的局限性：
- 1）知识的获取比较困难。
- 2）用户必须说明他的需求，系统才能做出推荐，在这个过程中若找不到合适的推荐视频，用户需要修改其需求。

### 5.1.4 混合推荐方法

